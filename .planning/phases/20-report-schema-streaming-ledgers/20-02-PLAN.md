# Phase 20-02 Plan

## Objective

Implement JSONL event-row external artifacts and viewer streaming iterators so timeline consumers can process reports without loading full external ledger JSON.

## Tasks

1. Extend report artifact writing in `packages/engine-mcp/src/agent-play.ts`:
- add JSONL external ledger writer for split artifacts,
- include descriptor metadata for JSONL storage format and file paths (raw + optional gzip),
- keep backward compatibility for existing external JSON payload format.
2. Extend report-viewer adapter (`packages/engine-mcp/src/report-viewer.ts`):
- support new external descriptor metadata,
- add async event iterators for JSONL external ledgers,
- keep sync APIs for inline/packed and hydrated legacy flows.
3. Update smoke tooling (`packages/engine-mcp/scripts/report-viewer-smoke.ts`) to validate JSONL stream iteration path.
4. Update engine-mcp docs/env var guidance for stream-ledger output mode.
5. Run validation loop:
- `pnpm --dir packages/engine-mcp run typecheck`
- `pnpm --dir packages/engine-mcp run report:viewer:smoke`
- `pnpm --dir packages/engine-mcp run agent:play` (with split artifacts and JSONL mode)

## Verification

- Streaming iterator event count matches report metadata count.
- Turn-range iteration over JSONL stream matches aggregate event count.
- Existing packed/inline report-viewer behavior remains unchanged.
