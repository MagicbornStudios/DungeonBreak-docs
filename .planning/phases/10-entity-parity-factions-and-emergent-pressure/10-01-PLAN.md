---
phase: 10-entity-parity-factions-and-emergent-pressure
plan: 01
wave: 1
depends_on: ['09-01']
files_modified: []
autonomous: true
gap_closure: false
must_haves:
  truths:
    - "Player and NPCs share the same legal action model."
    - "Rune forge and treasure room density constraints are encoded."
    - "Per-turn hostile spawn pressure is active and rune forge remains safe haven."
    - "Skill evolution and run-exclusive appraisal/xray branch are represented."
    - "Faction/reputation + trait checks gate lethal behavior."
    - "Rumor propagation and per-entity interaction logs are testable."
  artifacts:
    - path: ".planning/phases/10-entity-parity-factions-and-emergent-pressure/10-01-SUMMARY.md"
      provides: "Execution summary for phase 10 plan 01"
      min_lines: 10
  key_links:
    - from: ".planning/REQUIREMENTS.md"
      to: ".planning/phases/10-entity-parity-factions-and-emergent-pressure/10-01-SUMMARY.md"
      via: "phase 10 implementation traceability"
---

<objective>
Increase emergent simulation depth by enforcing entity action parity, adding persistent pressure systems, and introducing social/faction mechanisms that shape behavior and available options over time.
</objective>

<context>
@.planning/PRD-text-adventure-embeddings-demo.md
@.planning/phases/10-entity-parity-factions-and-emergent-pressure/10-CONTEXT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
</context>

<tasks>
<task type="auto">
  <name>Implement shared action policy model for player and NPC entities</name>
  <files>src/dungeonbreak_narrative/escape_the_dungeon/engine/*.py, src/dungeonbreak_narrative/escape_the_dungeon/player/*.py, src/dungeonbreak_narrative/escape_the_dungeon/entities/*.py</files>
  <action>Centralize legal action generation and prerequisite checks into one catalog, and refit NPC behavior to score/select from the same legal set.</action>
  <verify>Given same state and deterministic seed, legal action set is equivalent between player and NPC APIs.</verify>
  <done>Parity model is in place and used by runtime turn loop.</done>
</task>

<task type="auto">
  <name>Implement world density and pressure rules</name>
  <files>src/dungeonbreak_narrative/escape_the_dungeon/world/*.py, src/dungeonbreak_narrative/escape_the_dungeon/engine/*.py</files>
  <action>Encode per-level room composition (20 treasure, 5 rune forge), boss placement, 4 dungeoneers per floor, and per-turn hostile spawn from exits with rune-forge navigation exclusion.</action>
  <verify>Automated checks assert composition counts and per-turn spawn behavior.</verify>
  <done>World generation and turn simulation satisfy density/pressure constraints.</done>
</task>

<task type="auto">
  <name>Implement skill evolution and exclusive branch logic</name>
  <files>src/dungeonbreak_narrative/escape_the_dungeon/narrative/*.py, src/dungeonbreak_narrative/escape_the_dungeon/engine/*.py</files>
  <action>Add skill evolution trees requiring rune forge interaction and enforce run-exclusive `appraisal` vs `xray` acquisition.</action>
  <verify>Tests show only one branch unlocks per run and evolution requires rune forge + prerequisites.</verify>
  <done>Skill tree and exclusive branch policy are stable and testable.</done>
</task>

<task type="auto">
  <name>Implement factions, reputation, rumor spread, companion cap, and event boundaries</name>
  <files>src/dungeonbreak_narrative/escape_the_dungeon/entities/*.py, src/dungeonbreak_narrative/escape_the_dungeon/narrative/*.py, src/dungeonbreak_narrative/escape_the_dungeon/engine/*.py</files>
  <action>Add faction/reputation state (including `Laughing Face`), lethal action gates, rumor propagation from deeds/livestreams, companion max=1 recruitment flow, and clear deterministic/global vs probabilistic/emergent event separation.</action>
  <verify>Tests assert murder gates, rumor influence, companion cap, and deterministic/emergent trigger boundaries.</verify>
  <done>Social/faction/event systems produce emergent yet explainable outcomes.</done>
</task>

<task type="auto">
  <name>Add broad pytest coverage and update docs</name>
  <files>tests/*.py, .planning/*.md, README.md</files>
  <action>Create high-volume unit/integration tests for parity/pressure/social systems and update planning docs with traceable progress and boundaries.</action>
  <verify>`pytest` and `pytest-html` pass with new test suites and report output.</verify>
  <done>Phase 10 implementation is documented, test-backed, and loop-traceable.</done>
</task>
</tasks>
