# Phase 14-02 Plan - Contracts and Simulation Implementation

## Objectives

1. Implement schema-driven action/formula contracts for combat and narrative outcomes.
2. Implement deed misinformation memory model and propagation logic.
3. Add deterministic reference-run and golden trace replay coverage.
4. Add performance instrumentation and vector-usage reporting.

## Task Blocks

### Contracts and Data

- Add JSON schemas for actions, formulas, vectors, skills, items, cutscenes, and events.
- Move hardcoded constants into contract data files consumed by the TS runtime.
- Validate contracts at build/test time.

### Engine and Simulation

- Implement encounter-resolution weighting using contract inputs.
- Implement deterministic `flee` movement semantics.
- Add deed memory fields (`belief_state`, `source_entity_id`, `confidence`, `subject_entity_id`).
- Update rumor propagation to preserve and mutate confidence deterministically.

### Tests and Verification

- Add deterministic 25-turn integration scenario in unit/integration tests using `CANONICAL_SEED_V1 = 20260227`.
- Add golden trace fixtures for replay assertions.
- Add long-run pressure/performance tests and assert `p95 <= 2s` with pressure cap `120` when items are modeled as entities.
- Emit vector/feature usage report as CI artifact.

## Verification

- Contract schemas validate and runtime loads them without fallback to hidden constants.
- 25-turn reference run passes deterministically with stable snapshot hash.
- Performance profile test passes target and logs pruning decisions.
- Vector usage report is generated and available in CI artifacts.
